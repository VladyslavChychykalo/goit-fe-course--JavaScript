"use strict";var urlList=getUrlFromLocalStorage(),form=document.querySelector(".url-form"),input=document.querySelector(".url-form__input"),addUrlButton=document.querySelector(".url-form__button"),cardSection=document.querySelector(".favorites-wrapper");function drawFavorites(){var e=document.querySelector("#favorites-template").innerHTML.trim(),t=Handlebars.compile(e),r=urlList.reduce(function(e,r){return e+t(r)},"");cardSection.insertAdjacentHTML("afterbegin",r)}function onUrlAdding(e){e.preventDefault();var t="http://api.linkpreview.net/?key=5c8ce7f5e8eabc0a94cff7a1e60bd1c87bc2f4d0d14c4&q="+input.value;/^(ftp|http|https):\/\/[^ "]+$/.test(input.value)?fetch(t).then(function(e){if(e.ok)return e.json();throw new Error("error"+e.statusText)}).then(function(e){urlList.find(function(t){return t.url===e.url})?(alert("Такая закладка уже существует!"),console.log(e)):(cardSection.innerHTML="",urlList.unshift(e),setUrlToLocalStorage(urlList),drawFavorites())}).catch(function(e){return console.log(e)}):alert("Не прошло валидацию!"),form.reset()}function onDeleteClick(e){if("BUTTON"===e.target.nodeName){var t=e.target.parentNode,r=t.querySelector(".favorites-card__url").textContent,o=urlList.indexOf(urlList.find(function(e){return e.url===r}));t.remove(),urlList.splice([o],1),setUrlToLocalStorage(urlList)}}function setUrlToLocalStorage(e){localStorage.setItem("favourites-links",JSON.stringify(e))}function getUrlFromLocalStorage(){var e=localStorage.getItem("favourites-links");return e?JSON.parse(e):[]}drawFavorites(),console.log(urlList),form.addEventListener("submit",onUrlAdding),cardSection.addEventListener("click",onDeleteClick);